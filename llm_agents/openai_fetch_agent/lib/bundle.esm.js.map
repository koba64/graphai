{"version":3,"file":"bundle.esm.js","sources":["../../llm_utils/lib/index.js","../src/openai_fetch_agent.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getMessages = exports.getMergeValue = exports.flatString = void 0;\nconst flatString = (input) => {\n    return Array.isArray(input) ? input.filter((a) => a).join(\"\\n\") : (input ?? \"\");\n};\nexports.flatString = flatString;\nconst getMergeValue = (namedInputs, params, key, values) => {\n    const inputValue = namedInputs[key];\n    const paramsValue = params[key];\n    return inputValue || paramsValue ? [(0, exports.flatString)(inputValue), (0, exports.flatString)(paramsValue)].filter((a) => a).join(\"\\n\") : (0, exports.flatString)(values);\n};\nexports.getMergeValue = getMergeValue;\nconst getMessages = (systemPrompt, messages) => {\n    const messagesCopy = [...(systemPrompt ? [{ role: \"system\", content: systemPrompt }] : []), ...(messages ?? [])];\n    return messagesCopy;\n};\nexports.getMessages = getMessages;\n","import OpenAI from \"openai\";\nimport { AgentFunction, AgentFunctionInfo, sleep } from \"graphai\";\nimport { GraphAILLMInputBase, getMergeValue, getMessages } from \"@graphai/llm_utils\";\n\ntype OpenAIInputs = {\n  model?: string;\n  images?: string[];\n  tools?: OpenAI.ChatCompletionTool[];\n  tool_choice?: OpenAI.ChatCompletionToolChoiceOption;\n  max_tokens?: number;\n  verbose?: boolean;\n  temperature?: number;\n  messages?: Array<OpenAI.ChatCompletionMessageParam>;\n  response_format?: any;\n} & GraphAILLMInputBase;\n\ntype OpenAIConfig = {\n  baseURL?: string;\n  apiKey?: string;\n  stream?: boolean;\n};\n\ntype OpenAIParams = OpenAIInputs & OpenAIConfig;\n\nconst convertOpenAIChatCompletion = (response: OpenAI.ChatCompletion, messages: OpenAI.ChatCompletionMessageParam[]) => {\n  const message = response?.choices[0] && response?.choices[0].message ? response?.choices[0].message : null;\n  const text = message && message.content ? message.content : null;\n\n  const functionResponse = message?.tool_calls && message?.tool_calls[0] ? message?.tool_calls[0] : null;\n  // const functionId = message?.tool_calls && message?.tool_calls[0] ? message?.tool_calls[0]?.id : null;\n\n  const tool = functionResponse\n    ? {\n        id: functionResponse.id,\n        name: functionResponse?.function?.name,\n        arguments: (() => {\n          try {\n            return JSON.parse(functionResponse?.function?.arguments);\n          } catch (__e) {\n            return undefined;\n          }\n        })(),\n      }\n    : undefined;\n\n  if (message) {\n    messages.push(message);\n  }\n  return {\n    ...response,\n    text,\n    tool,\n    message,\n    messages,\n  };\n};\n\nexport const openAIFetchAgent: AgentFunction<OpenAIParams, Record<string, any> | string, OpenAIInputs, OpenAIConfig> = async ({\n  filterParams,\n  params,\n  namedInputs,\n  config,\n}) => {\n  const { verbose, system, images, temperature, tools, tool_choice, max_tokens, prompt, messages, response_format } = {\n    ...params,\n    ...namedInputs,\n  };\n\n  const { apiKey, stream, baseURL } = {\n    ...params,\n    ...(config || {}),\n  };\n\n  const userPrompt = getMergeValue(namedInputs, params, \"mergeablePrompts\", prompt);\n  const systemPrompt = getMergeValue(namedInputs, params, \"mergeableSystem\", system);\n\n  const messagesCopy = getMessages<OpenAI.ChatCompletionMessageParam>(systemPrompt, messages);\n\n  if (!apiKey) {\n    throw new Error(\"OPENAI_API_KEY key is not set in params. params: {apiKey: 'sk-xxx'}\");\n  }\n\n  if (userPrompt) {\n    messagesCopy.push({\n      role: \"user\",\n      content: userPrompt,\n    });\n  }\n  if (images) {\n    const image_url =\n      params.model === \"gpt-4-vision-preview\"\n        ? images[0]\n        : {\n            url: images[0],\n            detail: \"high\",\n          };\n    messagesCopy.push({\n      role: \"user\",\n      content: [\n        {\n          type: \"image_url\",\n          image_url,\n        } as OpenAI.ChatCompletionContentPart,\n      ],\n    });\n  }\n\n  if (verbose) {\n    console.log(messagesCopy);\n  }\n\n  const chatParams = {\n    model: params.model || \"gpt-4o\",\n    messages: messagesCopy as unknown as OpenAI.ChatCompletionMessageParam[],\n    tools,\n    tool_choice,\n    max_tokens,\n    temperature: temperature ?? 0.7,\n    stream: !!stream,\n    response_format,\n  };\n\n  const urlPrefix = baseURL ?? \"https://api.openai.com/v1\";\n  const response = await fetch(urlPrefix + \"/chat/completions\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Bearer ${apiKey}`,\n    },\n    body: JSON.stringify(chatParams),\n  });\n\n  if (!stream) {\n    if (response.status === 200) {\n      const result = await response.json();\n      return convertOpenAIChatCompletion(result, messagesCopy);\n    }\n    throw new Error(\"OPENAI API Error\");\n  }\n\n  // streaming\n  const reader = response.body?.getReader();\n\n  if (response.status !== 200 || !reader) {\n    throw new Error(\"Request failed\");\n  }\n\n  const decoder = new TextDecoder(\"utf-8\");\n  let done = false;\n  const buffer = [];\n  let text_buffer = \"\";\n  while (!done) {\n    const { done: readDone, value } = await reader.read();\n    if (readDone) {\n      done = readDone;\n      reader.releaseLock();\n    } else {\n      const text = decoder.decode(value, { stream: true });\n      text_buffer = text + text_buffer;\n      const lines = text_buffer.split(/\\n+/);\n      const next_buff = [];\n      for (const line of lines) {\n        try {\n          const json_text = line.replace(/^data:\\s*/, \"\");\n          if (json_text === \"[DONE]\") {\n            break;\n          } else if (json_text) {\n            const data = JSON.parse(json_text);\n            const token = data.choices[0].delta.content;\n            if (token) {\n              buffer.push(token);\n              if (filterParams && filterParams.streamTokenCallback && token) {\n                filterParams.streamTokenCallback(token);\n              }\n            }\n          }\n        } catch (__error) {\n          next_buff.push(line);\n        }\n      }\n      text_buffer = next_buff.join(\"\\n\");\n    }\n  }\n  return convertOpenAIChatCompletion(\n    {\n      choices: [\n        {\n          message: {\n            role: \"assistant\",\n            content: buffer.join(\"\"),\n            refusal: \"\",\n          },\n        },\n      ],\n    } as any,\n    messagesCopy,\n  );\n};\n\nconst input_sample = \"this is response result\";\nconst result_sample = {\n  object: \"chat.completion\",\n  id: \"chatcmpl-9N7HxXYbwjmdbdiQE94MHoVluQhyt\",\n  choices: [\n    {\n      message: {\n        role: \"assistant\",\n        content: input_sample,\n      },\n      finish_reason: \"stop\",\n      index: 0,\n      logprobs: null,\n    },\n  ],\n  created: 1715296589,\n  model: \"gpt-3.5-turbo-0125\",\n};\n\nexport const openAIMockAgent: AgentFunction<\n  {\n    model?: string;\n    query?: string;\n    system?: string;\n    verbose?: boolean;\n    temperature?: number;\n  },\n  Record<string, any> | string,\n  string | Array<any>\n> = async ({ filterParams }) => {\n  for await (const token of input_sample.split(\"\")) {\n    if (filterParams && filterParams.streamTokenCallback && token) {\n      await sleep(100);\n      filterParams.streamTokenCallback(token);\n    }\n  }\n\n  return result_sample;\n};\nconst openAIFetchAgentInfo: AgentFunctionInfo = {\n  name: \"openAIFetchAgent\",\n  agent: openAIFetchAgent,\n  mock: openAIMockAgent,\n  inputs: {\n    type: \"object\",\n    properties: {\n      model: { type: \"string\" },\n      system: { type: \"string\" },\n      tools: { type: \"object\" },\n      tool_choice: {\n        anyOf: [{ type: \"array\" }, { type: \"object\" }],\n      },\n      max_tokens: { type: \"number\" },\n      verbose: { type: \"boolean\" },\n      temperature: { type: \"number\" },\n      baseURL: { type: \"string\" },\n      apiKey: {\n        anyOf: [{ type: \"string\" }, { type: \"object\" }],\n      },\n      stream: { type: \"boolean\" },\n      prompt: {\n        type: \"string\",\n        description: \"query string\",\n      },\n      messages: {\n        anyOf: [{ type: \"string\" }, { type: \"object\" }, { type: \"array\" }],\n        description: \"chat messages\",\n      },\n    },\n  },\n  output: {\n    type: \"object\",\n    properties: {\n      id: {\n        type: \"string\",\n      },\n      object: {\n        type: \"string\",\n      },\n      created: {\n        type: \"integer\",\n      },\n      model: {\n        type: \"string\",\n      },\n      choices: {\n        type: \"array\",\n        items: [\n          {\n            type: \"object\",\n            properties: {\n              index: {\n                type: \"integer\",\n              },\n              message: {\n                type: \"array\",\n                items: [\n                  {\n                    type: \"object\",\n                    properties: {\n                      content: {\n                        type: \"string\",\n                      },\n                      role: {\n                        type: \"string\",\n                      },\n                    },\n                    required: [\"content\", \"role\"],\n                  },\n                ],\n              },\n            },\n            required: [\"index\", \"message\", \"logprobs\", \"finish_reason\"],\n          },\n        ],\n      },\n      usage: {\n        type: \"object\",\n        properties: {\n          prompt_tokens: {\n            type: \"integer\",\n          },\n          completion_tokens: {\n            type: \"integer\",\n          },\n          total_tokens: {\n            type: \"integer\",\n          },\n        },\n        required: [\"prompt_tokens\", \"completion_tokens\", \"total_tokens\"],\n      },\n      text: {\n        type: \"string\",\n      },\n      tool: {\n        arguments: {\n          type: \"object\",\n        },\n        name: {\n          type: \"string\",\n        },\n      },\n      message: {\n        type: \"object\",\n        properties: {\n          content: {\n            type: \"string\",\n          },\n          role: {\n            type: \"string\",\n          },\n        },\n        required: [\"content\", \"role\"],\n      },\n    },\n    required: [\"id\", \"object\", \"created\", \"model\", \"choices\", \"usage\"],\n  },\n  params: {\n    type: \"object\",\n    properties: {\n      model: { type: \"string\" },\n      system: { type: \"string\" },\n      tools: { type: \"object\" },\n      tool_choice: { anyOf: [{ type: \"array\" }, { type: \"object\" }] },\n      max_tokens: { type: \"number\" },\n      verbose: { type: \"boolean\" },\n      temperature: { type: \"number\" },\n      baseURL: { type: \"string\" },\n      apiKey: { anyOf: [{ type: \"string\" }, { type: \"object\" }] },\n      stream: { type: \"boolean\" },\n      prompt: { type: \"string\", description: \"query string\" },\n      messages: { anyOf: [{ type: \"string\" }, { type: \"object\" }, { type: \"array\" }], description: \"chat messages\" },\n    },\n  },\n  outputFormat: {\n    llmResponse: {\n      key: \"choices.$0.message.content\",\n      type: \"string\",\n    },\n  },\n  samples: [\n    {\n      inputs: { prompt: input_sample },\n      params: {},\n      result: result_sample,\n    },\n  ],\n  description: \"OpenAI Fetch Agent\",\n  category: [\"llm\"],\n  author: \"Receptron team\",\n  repository: \"https://github.com/receptron/graphai\",\n  license: \"MIT\",\n  stream: true,\n  npms: [\"openai\"],\n};\n\nexport default openAIFetchAgentInfo;\n"],"names":["getMergeValue","getMessages"],"mappings":"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"}